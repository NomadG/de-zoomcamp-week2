id: de_homework_02
namespace: zoomcamp
description: |
  Best to add a label `backfill:true` from the UI to track executions created via a backfill.
  CSV data used here comes from: https://github.com/DataTalksClub/nyc-tlc-data/releases

# inputs:
  # - id: taxi
#     type: SELECT
#     displayName: Select taxi type
#     values: [yellow, green]
#     defaults: green

inputs:
  - id: months
    type: ARRAY
    itemType: STRING
    defaults:
      - "01"
      - "02"
      - "03"
      - "04"
      - "05"
      - "06"
      - "07"
      # - "08"
      # - "09"
      # - "10"
      # - "11"
      # - "12"

tasks:
  - id: loop_months
    type: io.kestra.plugin.core.flow.ForEach
    values: "{{ inputs.months }}"
    tasks:


    - id: loop_taxi_color
      type: io.kestra.plugin.core.flow.ForEach
      values:
        - yellow
        - green
      tasks:

        - id: log_current_iteration
          type: io.kestra.plugin.core.log.Log
          message: |
            Processing:
              Taxi type = {{ taskrun.value }}
              Month     = {{ parent.taskrun.value }}
        
        - id: call_ingestion_subflow
          type: io.kestra.plugin.core.flow.Subflow
          namespace: zoomcamp
          flowId: taxi_ingestion_core
          inputs:
            taxi: "{{ taskrun.value }}"
            month: "{{ parent.taskrun.value }}"
            year: "2021"

